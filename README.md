# WebVRM - VTuber配信アプリケーション

VRMモデルを使用したリアルタイムトラッキング配信アプリケーションです。Three.jsと@pixiv/three-vrmを使用してVRMモデルをレンダリングし、MediaPipeで顔・上半身・手のトラッキングを行います。

## 機能

- **VRMモデルの読み込み**: ドラッグ&ドロップまたはファイル選択でVRMモデルを読み込み
- **リアルタイムトラッキング**:
  - MediaPipe Face Landmarker: 顔の表情と頭の動き
  - MediaPipe Pose Landmarker: 上半身の動き
  - MediaPipe Hand Landmarker: 手と指の動き
- **リップシンク**: マイク入力とMediaPipeトラッキングの組み合わせ
- **自動まばたき**: 自然な間隔での自動まばたき
- **背景カスタマイズ**: 色または画像の設定、グリーンバック/ブルーバック対応
- **ブラウザオーバーレイ**: YouTube、Twitch Chatなどの埋め込み
- **モデル調整**: 位置、スケール、回転の調整
- **デバッグモード**: FPS表示、トラッキングデータの確認
- **キーボードショートカット**: 素早い操作のためのショートカット

## 必要環境

- Node.js 18以上
- モダンなウェブブラウザ (Chrome、Edge推奨)
- Webカメラ (トラッキング機能を使用する場合)
- マイク (リップシンク機能を使用する場合)

## セットアップ

### 1. 依存関係のインストール

```bash
npm install
```

### 2. 開発サーバーの起動

```bash
npm run dev
```

ブラウザで `http://localhost:5173` を開きます。

### 3. プロダクションビルド

```bash
npm run build
```

ビルドされたファイルは `dist` フォルダに生成されます。

## 使い方

### VRMモデルの読み込み

1. VRMファイルをメインエリアにドラッグ&ドロップ
2. または「モデル」タブからファイルを選択

### トラッキングの開始

1. 「トラッキング」タブを開く
2. 「開始」ボタンをクリック
3. カメラへのアクセスを許可
4. カメラに顔を向けてトラッキング開始

### リップシンクの有効化

1. 「トラッキング」タブでマイクボタン(🎤)をクリック
2. マイクへのアクセスを許可
3. 音声レベルが表示され、口の動きに反映されます

### モデルの調整

「モデル」タブで以下を調整できます:
- X/Y/Z位置
- スケール (拡大/縮小)
- 回転

### 背景の設定

「背景」タブで以下を設定できます:
- 背景色の選択
- 背景画像のアップロード
- プリセット色 (グリーンバック、ブルーバック等)

### ブラウザオーバーレイ

「ブラウザ」タブで:
- URLを入力してウェブページを表示
- 位置とサイズを調整
- プリセット (YouTube、Twitch Chat等) を使用

## キーボードショートカット

- `↑↓←→`: モデルの移動
- `+/-`: スケール調整
- `R`: 回転
- `T`: トラッキングのオン/オフ
- `M`: マイクのオン/オフ
- `D`: デバッグモードの切り替え
- `Esc`: 設定パネルの表示/非表示
- `Shift`: 大きく移動 (矢印キーと組み合わせ)

## 技術スタック

- **React 18**: UIフレームワーク
- **Three.js**: 3Dレンダリング
- **@pixiv/three-vrm**: VRMモデルのロードと制御
- **MediaPipe Tasks Vision**: 顔・ポーズ・手のトラッキング
- **Vite**: ビルドツール
- **TailwindCSS**: スタイリング

## トラブルシューティング

### カメラが起動しない

- ブラウザの設定でカメラのアクセス許可を確認
- HTTPSまたはlocalhostでアクセスしているか確認
- 他のアプリケーションでカメラを使用していないか確認

### VRMモデルが表示されない

- .vrm形式のファイルであることを確認
- コンソールでエラーメッセージを確認
- モデルファイルが破損していないか確認

### トラッキングが不安定

- 十分な照明があるか確認
- カメラの解像度を確認 (1280x720推奨)
- 「トラッキング」タブでスムージング値を調整

### パフォーマンスが悪い

- デバッグモードでFPSを確認
- トラッキング機能の一部を無効化
- ブラウザのハードウェアアクセラレーションを有効化

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## クレジット

- VRMフォーマット: [VRM Consortium](https://vrm.dev/)
- Three.js VRMサポート: [@pixiv/three-vrm](https://github.com/pixiv/three-vrm)
- トラッキング: [MediaPipe](https://developers.google.com/mediapipe)
